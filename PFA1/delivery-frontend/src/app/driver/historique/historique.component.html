<!-- Loading State -->
<div *ngIf="loading" class="loading-container">
  <mat-spinner diameter="50"></mat-spinner>
  <p>Chargement de l'historique...</p>
</div>

<!-- Error State -->
<div *ngIf="error && !loading" class="error-container">
  <mat-icon class="error-icon">error_outline</mat-icon>
  <h2>Erreur</h2>
  <p>{{ error }}</p>
  <button mat-raised-button color="primary" (click)="loadMissions()">
    <mat-icon>refresh</mat-icon>
    Réessayer
  </button>
</div>

<!-- Historique Content -->
<div *ngIf="!loading && !error">
  <mat-card class="content-card history-card">
    <mat-card-header class="history-header">
      <div class="header-icon">
        <mat-icon>history</mat-icon>
      </div>
      <div class="header-content">
        <mat-card-title>Consultez toutes vos missions complétées</mat-card-title>
      </div>
      <div class="header-stats">
        <div class="stat-badge">
          <span class="stat-number">{{ getCompletedMissions().length }}</span>
          <span class="stat-label">Missions</span>
        </div>
      </div>
    </mat-card-header>
    <mat-card-content>
      <div class="history-timeline">
        <div *ngFor="let mission of getCompletedMissions(); let i = index" class="timeline-item" [class.completed]="mission.etat === 'TERMINEE'">
          <div class="timeline-marker">
            <div class="marker-dot">
              <mat-icon>{{ mission.etat === 'TERMINEE' ? 'check_circle' : 'cancel' }}</mat-icon>
            </div>
            <div class="marker-line" *ngIf="i < getCompletedMissions().length - 1"></div>
          </div>
          
          <div class="timeline-content">
            <div class="mission-card-history">
              <div class="mission-header-history">
                <div class="mission-info-history">
                  <h3 class="mission-title-history">Mission #{{ mission.id }}</h3>
                  <div class="mission-badges">
                    <mat-chip class="status-chip" [class]="getMissionStatusClass(mission.etat)">
                      <mat-icon>{{ mission.etat === 'TERMINEE' ? 'check_circle' : 'cancel' }}</mat-icon>
                      {{ getStatusText(mission.etat) }}
                    </mat-chip>
                    <mat-chip class="type-chip">
                      <mat-icon>category</mat-icon>
                      {{ mission.typeMission }}
                    </mat-chip>
                  </div>
                </div>
                <div class="mission-date-history">
                  <div class="date-display">
                    <mat-icon>calendar_today</mat-icon>
                    <div class="date-info">
                      <span class="date-text">{{ formatDate(mission.dateHeure) }}</span>
                      <span class="time-text">{{ formatTime(mission.dateHeure) }}</span>
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="mission-route-history">
                <div class="route-display">
                  <div class="route-point start-point">
                    <mat-icon>my_location</mat-icon>
                    <span>{{ mission.depart }}</span>
                  </div>
                  <div class="route-separator">
                    <mat-icon class="route-arrow">trending_flat</mat-icon>
                  </div>
                  <div class="route-point end-point">
                    <mat-icon>place</mat-icon>
                    <span>{{ mission.destination }}</span>
                  </div>
                </div>
              </div>
              
              <div class="mission-details-history" *ngIf="mission.instructions">
                <div class="details-section">
                  <mat-icon>description</mat-icon>
                  <span>{{ mission.instructions }}</span>
                </div>
              </div>
              
              <div class="mission-actions-history">
                <button mat-stroked-button class="details-btn-history" (click)="viewMissionDetails(mission.id)">
                  <mat-icon>visibility</mat-icon>
                  Voir Détails
                </button>
              </div>
            </div>
          </div>
        </div>

        <div *ngIf="getCompletedMissions().length === 0" class="empty-state-history">
          <div class="empty-icon">
            <mat-icon>history</mat-icon>
          </div>
          <h3>Aucune mission dans l'historique</h3>
          <p>Vos missions complétées apparaîtront ici</p>
        </div>
      </div>
    </mat-card-content>
  </mat-card>
</div>
